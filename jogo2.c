#include <stdio.h>
#include <stdlib.h>
#include <locale.h>
#include <windows.h>
#include <conio.h> //Para uso do _kbhit e do _getch
#include <time.h>

//cores
#define GREEN "\033[32m"
#define RESET "\033[0m"
#define RED   "\033[31m"
#define YELLOW "\033[33m"

//definidas pelo caio ↓
#define TAM_VILA 10
#define TAM_F1 10
#define TAM_F2 20
#define TAM_F3 40
#define FASE 4
#define TAM 40

//=========== artes em asci=========
char mapa[4][40][40];
char mapaAnterior[4][40][40];
char mapabackup[4][40][40]=
//mapa vila 0 ↓
{{{' ', ' ', '*', '*', '*', '*', '*', '*', '*', '*'},
      {' ', ' ', '*', 'g', 'g', 'g', 'g', 'g', 'g', '*'},
      {'*', '*', '*', 'g', 'g', 'g', 'g', 'g', 'g', '*'},
      {'*', 'g', 'g', 'g', 'P', 'g', 'g', 'g', 'g', '*'},
      {'*', 'D', 'g', 'g', 'g', 'g', 'g', 'g', 'g', '*'},
      {'*', 'D', 'g', 'g', 'g', '&', 'g', 'g', 'g', '*'},
      {'*', 'g', 'g', 'g', 'g', 'g', 'g', 'g', 'g', '*'},
      {'*', '*', '*', 'g', 'g', 'g', 'g', '@', 'g', '*'},
      {' ', ' ', '*', 'g', 'g', 'g', 'g', 'g', 'g', '*'},
      {' ', ' ', '*', '*', '*', '*', '*', '*', '*', '*'}},
     // mapa fase 1 ↓
     {{'*', '*', '*', '*', '*', '*', '*', '*', '*', '*'},
      {'*', ' ', ' ', '3', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', '3', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', '*', '1', '3', ' ', ' ', '@', ' ', ' ', '*'},
      {'*', 'L', '1', '3', ' ', ' ', ' ', ' ', '&', '*'},
      {'*', '*', '1', '3', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', '3', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', '3', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', 'D', '*'},
      {'*', '*', '*', '*', '*', '*', '*', '*', '*', '*'}},
     // mapa fase 2 ↓
     {{'*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '#', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', 'X', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', 'X', ' ', ' ', ' ', ' ', '#', '#', '#', '#', '#', '#', '#', '#', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '#', ' ', ' ', ' ', ' ', ' ', ' ', '#', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '#', ' ', ' ', ' ', ' ', ' ', ' ', '#', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', '#', '#', ' ', ' ', ' ', ' ', 'X', ' ', '#', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', '#', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '#', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', '#', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '#', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', 'X', ' ', '#', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', '#', '#', ' ', '#', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', '#', 'O', ' ', '#', ' ', ' ', ' ', ' ', ' ', '#', '#', '#', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', '#', ' ', ' ', '#', ' ', ' ', ' ', ' ', ' ', '#', ' ', '#', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', '#', '#', '#', '#', 'D', ' ', ' ', ' ', ' ', '#', '@', '#', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '#', '#', '#', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '#', '#', '#', ' ', ' ', '&', '*'},
      {'*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*'}},
     // mapa fase 3 ↓
     {{'*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', '#', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', '>', ' ', ' ', '#', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', 'O', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*', '*', '*', '*', '*'},
      {'*', '#', '#', '#', '#', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', '>', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', '@', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*', '*', '*', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*', '#', '#', '*', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', 'X', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '3', '3', '3', '3', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '3', '3', '3', '3', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '3', '2', '1', '1', '2', '3', ' ', ' ', ' ', ' ', ' ', '3', '2', '1', '1', '2', '3', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '3', '2', '#', '#', '#', '#', '2', '3', ' ', ' ', ' ', '3', '2', '#', '#', '#', '#', '2', '3', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '3', '1', '#', 'L', 'L', '#', '1', '3', ' ', ' ', ' ', '3', '1', '#', 'L', 'L', '#', '1', '3', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '3', '1', '#', 'L', 'L', '#', '1', '3', ' ', ' ', ' ', '3', '1', '#', 'L', 'L', '#', '1', '3', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '3', '2', '#', '#', '#', '#', '2', '3', ' ', ' ', ' ', '3', '2', '#', '#', '#', '#', '2', '3', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '3', '2', '1', '1', '2', '3', ' ', ' ', ' ', ' ', ' ', '3', '2', '1', '1', '2', '3', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '3', '3', '3', '3', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '3', '3', '3', '3', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', 'X', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', '*', '*', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', 'V', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', '*', '*', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', '*', '*', '*', '*', '*', '*', ' ', ' ', ' ', '*', '*', '*', '*', '*', '*', '*', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '#', '#', '#', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', 'D', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '#', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '#', '#', '#', '*'},
      {'*', ' ', '&', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '#', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', 'X', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'},
      {'*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*', '*'}}};

char cutscene1[50][160]={                                                                                                                        
{"                                                                                                                      \n"},
{"                                                                                                                      \n"},
{"                                                                      ##########               ###########            \n"},
{"                                                                      (*       (               %#        (            \n"},
{"                                                                      %####&##%(               #%#.. . *(#            \n"},
{"                                                                      #,/, .   #               (* ,  .   %            \n"},
{"                        #%#((%%#%                       &%            ##. %/ . (%%%  %%##% /%%%%*.., # .,#            \n"},
{"                     #*/ .,* . .    %                 # .#            %,/.(.   , .*.         **/(.(, ,   #            \n"},
{"                   &. *%..             %            %(/( .            #,,.      . *,  .    * , *//*./    &            \n"},
{"                  #.(/./ / , .    .  .   #         # ,/   /           #.        , .   (      .//*/(      %            \n"},
{"                 ,##,,( .. . .* *  .   %%%        #/.     /           %**. .   .   .*.    .. ,,(/,.,   . #            \n"},
{"                 #,/#.(,/(.,,*/ .. ,. #(         # ..    #            #*.*, . .   . /%#%##   ,*/%(.      (            \n"},
{"                  #,(#*./,(. ...  .,  %%        &,..    #             #,..    , .  .%%%%%#%.%./(*/* ,.   %            \n"},
{"                   #/**,***./  ,   ,..#         ., /   &              ,/.. .  /*,.  ####%%% ( ,/., ..  . %            \n"},
{"                 ####%%%&#/#.(*/ /%(.#         % .    ,               ,,,. , ... &, /##%&##./*(%  .   ,. #            \n"},
{"               #*%. /..*.     #%(%%           %.*     (                                                               \n"},
{"            /#%##*,*,*..  /***/*,.%          %,*     (                                                                \n"},
{"         %%,/%(/,,/%,%*(,(####/, #(%        # ,(,   #                                                                 \n"},
{"        # ***.(%(.*/,#(**( /      .  #     %. ...  *                                                                  \n"},
{"       #.(*,,,(((..,/*.*/,,* .. %#*  .%    *... .  #                                                                  \n"},
{"      %../* ((,.#(#.*,(. ...  /#. *   %   #,,..   (                                                                   \n"},
{"     %.,(,(***,#*.  ** *  ,.  %* *     %  (%/(/, (                                                                    \n"},
{"     #.*#/..(%*,((.*/  *,*.  #*., .    # %%((/*.*.#%                                                                  \n"},
{"    .**.( ///(* *,. ,  ./  . # *(,.    ##//(,.* ###(                                                                  \n"},
{"    (,,., (*..,.,(.. %*/*/(./#%**.(.   %(&,,%.*%/                                                                     \n"},
{"    # /, /( ..  /..*.,*   , %#%.,,*,  , ,#(/,(.&                                                                      \n"},
{"   %., /, * .*,(.. ./*..,*.(%(*%., (*. , #*( .#                                                                       \n"},
{"   (,*.// /*     ./.  ..  .*%(/(%#/,(,.#/&%                                                                           \n"},
{"   (. .,.. ., ., *, . ..   .*/(,*##(.#  ##,                                                                           \n"},
{"  (  *.    *,    ..        %/  ,..(*.#                                                                                \n"},
{"    .                 *    # **                                                                                       \n"},
{"                                                                                                                      \n"},
{"   #%&%%%#%%#%%&%#%%%%%#%#%#&#%%%&%%%%%%&&#%&%&#%&%#%&%%###&(&##&&##&%%&%%%&%##&%%&%%%%%%%%%%%%%@&%%&%%%#%%&&&&#%%%%&#\n"},
{"   %                                      ___     ____          _       _                                            %\n"},
{"   #                                     / _ \\   / ___|__ _ ___| |_ ___| | ___     ___                               #\n"},
{"   #                                    | | | | | |   / _` / __| __/ _ \\ |/ _ \\   / _ \\                              #\n"},
{"   %                                    | |_| | | |__| (_| \\__ \\ ||  __/ | (_) | | (_) |                             %\n"},
{"   #                                     \\___/   \\____\\__,_|___/\\__\\___|_|\\___/   \\___/                              #\n"},
{"   #                                       __| | ___  ___  __ _ / _(_) __ _                                          %\n"},
{"   %                                      / _` |/ _ \\/ __|/ _` | |_| |/ _` |                                         %\n"},
{"   #                                     | (_| |  __/\\__ \\ (_| |  _| | (_| |_ _ _ _ _ _ _ _ _ _                      %\n"},
{"   %                                      \\__,_|\\___||___/\\__,_|_| |_|\\__,_(_|_|_|_|_|_|_|_|_|_)                     #\n"},
{"   %                                                                                                                 #\n"},
{"   (#((//**/,,,*//.(//*,*//(/,//*#(*///(//*(/(**/(((/((((**//*/((/*/((((/*(#(((//(**/,//**/,*/(///////****//(**//#(# \n"}};

char cutscene2[50][250]={                                                                      
{"                              .@%%&@                                                                                                      "},
{"                        %&#&          .&%(&                                                                                               "}, 
{"                     &&%  * / .  *         %%%                                                                                            "},
{"                   &%#,/ . .  /     /         %%                                                                                          "},
{"                  %%   . % @  ,       #         %%                                                                                        "},
{"                *%(**#/         ,  ,  .          %&                                                                                       "},
{"               %%,    @ .  &    #  ,  *  .        %#                                                                                      "},
{"               &%* *.#  (  .                . .   &%                                                                .#%(*&%%%%%%@@.  &&   "},
{"              %% # * .% &  / /  .   .  ,    (      %.                                             #&##&&#%%%%@%.        &*%@ .    .#./&/  "},
{"              &*   % * .& .           ,           &%                              &%##&#%%%(*      / (/ &       ,/#//      .%/& .     %%  "},
{"              %&.  # / ,, .  (.    ,  #.          #%                               ,(.      .((/         .*(.     ./.&,.       .#*@ ( /#  "},
{"              %&.( &.,( , , ,. .. . /  /       .  *#                                 @&         %/&*%       .%  %.(    (&#../@,. .,, ,&%  "},
{"              *%&, #... ( #..% ( #  / .(  ,  .   %,                                    &%   .     .(@,%%.   *     ,#(%%/   ... #&. .  *%( "},
{"               @&%.  ,@.% . #    % .  /  ,. ,   %%                                       #& % *        . .# %, ..    , / *,,,*,  . /.*,%# "},
{"                 &%/% / & (   #  * ,, &  *  *  &%                                          /&  *%(.,.       ,*%%,(/.        %@/#  #   #&% "},
{"                   &%% @*/,((%.. *., /.  *  (&%,                                             &, ,  #.%,&/   .// ,%*@%#**   .. **(*%%//,%% "},
{"                  @&&&&(%&%&((#/&%%&%&%#*#%%                                                  //&     ( ,@%*/** /  . &&(/#. , .(   ,.(.*(%"},
{"             %%& ( #  *. ., *    (        *%%%%%                                                (& ,,  ,*.(///  /(/ /..# (,(%%&#,, *, .*%&"},
{"           %% &.& .&.*     &          #        /%                                                 @%  ,*/ (%,(,.,#*@  *./,,* #.,((///*,%*%"},
{"        (#& / &.### ** /. *#./ *& /((* .%./    .&%(                                               &%*       */(*/%&#%#*#@%%%%/%%&(#@%&%#%%"},
{"      #,% & *,.@, % *  ( .,(/&/      ,             (%                                          &% /*%%/%/%.*@./. (#@.*/,**.&(&,& /(,&. #% "},
{"     %# ,  .(. ,  . * %     ,.   ,.   .*             @%                                     %%. ..  & .  ,  #.#%./,/&,.(,**.##*.#(.( ,%#  "},
{"    ##  /,%./% *   .  ..   &  (  ,  *,     *          %&                                 &%%&% ,  &%%(.(%@%,&(%(.(&&#%,&.((&(%%###((%(    "},
{"    %%, *(#..#/,#/ #,* */  #  / ((/* (  ,  * #  *     &#                              @/&  ( /.%#%&%*%%@% &&#%%%%@@/(%/%&#%&%&#%#%(&#     "},
{"   %%   * /  . * & * /  ( # .%#(     %  *  . ,  ,      &%                          .%% , . # ((#%/%&%##&/ &%(/%(&/% %*&#%*#&%%%%%&#*      "},
{"   &&*,,( # *%.# &#/(. #@(#.    % .        ( *    ..   &%                        %&  ., # &%#%#(%&%%%#//,@%%#%#&&%%/.(% &&&&&/#((%        "},
{"  &#, . *  * ##.,*.,@  *., % %  & ./ *  *    (  .      #&                     ##@ ,   . #&@.&%#&&.##%(#&#%((&#&%&#/%#%%% %%%&&#%&         "},
{"  %%/,,(*( ##(/ . ( .,   @    ( /..,. /** .  ,         &#                  &#@ / (   %&(,%%*%(( %&*%,%%##&%%&#%//%&,#%%%&%%%&%%           "},
{"  %%* % #.//%( ., # /  ,/**&% *  % . . #/  ..          &%                &&   #   &&(*/(.& %%%%%%%&&%%%%#%,%%/%%%**%%#%*&%%&%(            "},
{" .&( ,, %. & /  *,,..  # *  # ,  * / ..#/.  %  &  &    #*                   *%&&%#%%##&(*&#/%%%%&@**##&/,#%%**&%%%&&#&##/%*(,             "},
{" %%   , (& %,%  / /  , %.** ,  . * *,#.#%#  .  #  /    &#                                         @%#%((%%%%*#(#&&%@&%#%##%               "},
{" %% ,%**,  / (  * %. ##*  # (  . .(* ((%/.@/*     .    *%                                                                                 "},
{" &&. ( %#  # #  % (  / (  . / .  #.(. /%, &.(  . *  ,   %                                                                                 "},
{" %%,** %,  ( ,/ , ,  #*%  ,.,* ...../ &( ., *           #(                                                                                "},
{",%,%/. @(, * *  *    ( .. . .  ,  & /*./ .% /    .      (&                                                                                "},
{"(& **@ .%( /  % (   (   ..&( *, * %/, /&%  ,, /, . ,    (#                                                                                "},
{"(* (   ,.  %            # /  ,  .   (,,(( & . *    ( &  %*                                                                                "}
                                                                                                                                       
};

char cutsceneFinal[80][250]={
{"                                                                    \033[33m            #&&                          "},
{"                                                                           ##%         %% &&            #            "},
{"                                                                            %*&&&     %@   #%        (##&            "},
{"                                                                            (#   @##/%%    %,(&  (,%&  &#            "},
{"                                                                            @/      (    * ,. &(#   &.&@             "},
{"                                                                             %%       *    .  , ../** &(             "},
{"                                                                             &#       .       %   ( ,%&              "},
{"                                                                             #&,      , * ., ,. .    /%              "},
{"                                                                                 &%.%(%(#%%&%&(#&%@#          \033[0m"},
{"                                                                                                                     "},
{"                                                                       //%,%%##@&%&#@%@%&%##&%@@/#@/(###*@&/#@       "},
{"                       _ ****- _                                  @*#&/                (/ , *.*   *.,.   /. / %&/%@  "},
{"                     %% ./     %#                               &%   ,    ,&@#*%((% &#*@%(((%(%%#&%&#%&&%%%&#& /, .#&"},
{"                   .%.. /    .   &#                             &&   .                  .  *  (. , .*,. #,. *./,(& &&"},
{"                   %.  *, * .     #             ##              #&% ,              @ .  .  , .  ,, . ,,&/ .*@/#.(,.##"},
{"                  #%  *  * .      %/         %# *#                  (#&#%%%%&%##*#&@%&&*&#(&%#%&###%&@%###%%(%%&#    "},
{"                   #(. ./  . ,  * &         &  *##                    #/(% & && #,#%  #  # &,,(% //,, % *#*%#((      "},
{"                    %/(* // *. ,,#         #    #                     &%(  . . %* .* # // .*.&** /,,, * # /(@.#/     "},
{"                     #&##*,***%%          # .//#                      &(          .    ,  ( #, /.* (/,% . (./.##     "},
{"                  %%#.,//%///#.#         ( **,&                       %#  *          / ..   ( .*..  .&, % * ..&(     "},
{"                (/. .% .*#,/.(,(*%      # /**%                        &&               (  . ,    ( # ,* * /.@,%#     "},
{"               (%   ,. ,, *  *. /(#    ( %* #                         %(  ,            (    .    .   (./* / #.#%     "},
{"               #@.,. .,, /  , ..%.%  ,% *..#                          %%               .    , ,  & * ,,(* /. .&&     "},
{"                % . , ..# .. /*,%/#%#% ..,#                           #@  ,         ,    . .,    # , ., / &*& %/     "},
{"                &#,%%,. %//*#(/(%,%#., %%(                            *%            .       , ,  , &  * .,,*/,(%     "},
{"                #(*%//..  %/    (*   .,%#%%                           &(  *               . . *  / , .# *.%,.,##     "},
{"                 #%%%&##,(( ,./,%/, %/%                               /%             * ,    #    & ,  /**,,%..#&     "},
{"                #,/././(*#*/(/**/%#/%                                 /%  / .                  & , .  .  * ( .%%     "},
{"                #*, / **.( ,* ,/**&%                                  (%        #  ,    * .    (    .  %.#%*..(/     "},
{"               %,.  .#  * .. **. ,%.                                  /%    .           *  . # (  / , *  ,,*#.&&     "},
{"               %.  /, *    .*  //*,#                                  %(                ,  * .    . .# . .*. .%%     "},
{"                &%##   .     /%&#%(                                   /(  %   .    .  ,    .    .    # /#,& ..%&     "},
{"                &,  /*(#   %*%.*.#                                    (/                 . .  # ,/ , .. ( (.#,%%     "},
{"               ,%..**.%    /% ..%#                                    #(*       ,   &    *    .  / %. &.,.(#/ %(     "},
{"               #. ,* #     ##/,*.%                                    %@            ,  .    /    .  , % ,, #**/#     "},
{"              %*  /.%       &   .%                                    #%,                      ,  % #  , &.  .@(     "},
{"              %, ,#%.       %*( .%(                                   %#             .      .*      #  #.%/ (/&(     "},
{"             *(,, ,&        % ., *%                                   %(    ,   .       .    @  .  * , (# ..*.##     "},
{"             #(*%.#%        /( (/ .(##                                %&                      *  . , ( .# **%/@*     "},
{"             #. ,*  # / / /./%%/*. .. #%.                             %&  *              .  * (. &    #,,%##,,%%     "},
{"                (#%* , .   ,                                          %&               .    .  ( (. , /**, *..&%     "},
{"                                                                      %@               *  #  * (  , *%.#.* (. %,     "},
{"                                                                      ##  /            .     /  #    %.% * & .&/     "},
{"                                                                      &%                & (/ *  , #@ * (.&%( ,(#     "},
{"                                                                      %&                @  /  ,  * % ##/, # @,#%     "},
{"                                                                      &#              .  .       / , /% @%%,@,&(     "},
{"                                                                      #@            ,    %  / /# #,.. & */ / ,@%     "},
{"                                                                      &%  % .     .  . ,  & *( , % .%, # . / .&/     "},
{"                                                                      @#  /          ,    *    #, #. & & . ( @#*     "},
{"                                                                       (((&(#        &    .& (  /   * . &@(#(@       "},
{"                                                                              /&/@#%&###&#&(#&#%&&#&%@/              "}
};
//menu em ascii ↓
/*char menuletra[10][250]={
{" _____ ______   _______   ________   ___  ___      \n"},     
{"|\\   _ \\  _   \\|\\  ___ \\ |\\   ___  \\|\\  \\|\\  \\     \n"},
{"\\ \\  \\\\\\__\\ \\  \\ \\   __/|\\ \\  \\\\ \\  \\ \\  \\\\\\  \\    \n"},
{" \\ \\  \\\\|__| \\  \\ \\  \\_|/_\\ \\  \\\\ \\  \\ \\  \\\\\\  \\   \n"},
{"  \\ \\  \\    \\ \\  \\ \\  \\_|\\ \\ \\  \\\\ \\  \\ \\  \\\\\\  \\  \n"},
{"   \\ \\__\\    \\ \\__\\ \\_______\\ \\__\\\\ \\__\\ \\_______\\ \n"},
{"    \\|__|     \\|__|\\|_______|\\|__| \\|__|\\|_______| \n"}
};
*/


char menuletra[25][250]={
{" ▄████▄   ▄▄▄        ██████ ▄▄▄█████▓ ██▓    ▓█████            \n"},
{"▒██▀ ▀█  ▒████▄    ▒██    ▒ ▓  ██▒ ▓▒▓██▒    ▓█   ▀            \n"},
{"▒▓█    ▄ ▒██  ▀█▄  ░ ▓██▄   ▒ ▓██░ ▒░▒██░    ▒███              \n"},
{"▒▓▓▄ ▄██▒░██▄▄▄▄██   ▒   ██▒░ ▓██▓ ░ ▒██░    ▒▓█  ▄            \n"},
{"▒ ▓███▀ ░ ▓█   ▓██▒▒██████▒▒  ▒██▒ ░ ░██████▒░▒████▒           \n"},
{"░ ░▒ ▒  ░ ▒▒   ▓▒█░▒ ▒▓▒ ▒ ░  ▒ ░░   ░ ▒░▓  ░░░ ▒░ ░           \n"},
{"  ░  ▒     ▒   ▒▒ ░░ ░▒  ░ ░    ░    ░ ░ ▒  ░ ░ ░  ░           \n"},
{"░          ░   ▒   ░  ░  ░    ░        ░ ░      ░              \n"},
{"░ ░            ░  ░      ░               ░  ░   ░  ░           \n"},
{"░                                                              \n"},
{" ▄████▄   ▒█████   ███▄    █   █████   █    ██ ▓█████  ██▀███  \n"},
{"▒██▀ ▀█  ▒██▒  ██▒ ██ ▀█   █ ▒██▓  ██▒ ██  ▓██▒▓█   ▀ ▓██ ▒ ██▒\n"},
{"▒▓█    ▄ ▒██░  ██▒▓██  ▀█ ██▒▒██▒  ██░▓██  ▒██░▒███   ▓██ ░▄█ ▒\n"},
{"▒▓▓▄ ▄██▒▒██   ██░▓██▒  ▐▌██▒░██  █▀ ░▓▓█  ░██░▒▓█  ▄ ▒██▀▀█▄  \n"},
{"▒ ▓███▀ ░░ ████▓▒░▒██░   ▓██░░▒███▒█▄ ▒▒█████▓ ░▒████▒░██▓ ▒██▒\n"},
{"░ ░▒ ▒  ░░ ▒░▒░▒░ ░ ▒░   ▒ ▒ ░░ ▒▒░ ▒ ░▒▓▒ ▒ ▒ ░░ ▒░ ░░ ▒▓ ░▒▓░\n"},
{"  ░  ▒     ░ ▒ ▒░ ░ ░░   ░ ▒░ ░ ▒░  ░ ░░▒░ ░ ░  ░ ░  ░  ░▒ ░ ▒░\n"},
{"░        ░ ░ ░ ▒     ░   ░ ░    ░   ░  ░░░ ░ ░    ░     ░░   ░ \n"},
{"░ ░          ░ ░           ░     ░       ░        ░  ░   ░     \n"},
{"░                                                              \n"}
};




//======== variaveis globais ================
int jogadorX = 1, jogadorY = 1;
int posInicialX = 1, posInicialY = 1;
int chaveColetada = 0;
int reinicios = 0;
int interacao = 0;
int i, j, k;
int faseatual=0;
int morto=0;
char embaixoDoJogador = ' ';// armazena o que ta embaixo do jogador (pode ser ' ', '@', etc.)
char textoNpc[350]={"Os ecos do castelo rugem....ele clama por um desafiante....\nSe você for adentrá-lo, que fique de dica:\nUse W,A,S,D para se movimentar e I para interagir...\nPor favor, fique longe dos #,X e V... principalmente do V....mas não tenha medo, os monstros não gostam de luz...\nE cuidado... o castelo permite apenas 3 erros....\n\n"};

/*================== funcões =============================================
  ================== funcões =============================================
  ================== funcões =============================================
  ================== funcões =============================================
  ================== funcões =============================================
  ================== funcões =============================================
  ================== funcões =============================================
  ================== funcões =============================================
*/
//============funcões de posicões e coordenadas do cursor =========
void coordenadas(int x, int y)
{
COORD coord;
coord.X = x*2;
coord.Y = y;
SetConsoleCursorPosition(GetStdHandle(STD_OUTPUT_HANDLE),coord);
}

void cursorRodape() {
    int tam;
    if (faseatual == 0) tam = TAM_VILA;
    else if (faseatual == 1) tam = TAM_F1;
    else if (faseatual == 2) tam = TAM_F2;
    else tam = TAM_F3;
    coordenadas(0, tam ); // Linha logo após o mapa
}
/*
void cursorCentral()
{
    int tam;
    if (faseatual == 0) tam = TAM_VILA;
    else if (faseatual == 1) tam = TAM_F1;
    else if (faseatual == 2) tam = TAM_F2;
    else tam = TAM_F3;
    coordenadas(200,150+tam);
}
*/

void limparTexto()
{
    cursorRodape();
    for (i = 0; i < 20; i++)
    {
        for ( j = 0; j < 100; j++)
        {
            printf(" ");
        }
        printf("\n");
    }
}

//=========== funcões relacionas a mapas, no geral ============================

void imprimirMapa() 
{
    if(faseatual == 0){
        for (i = 0; i < TAM_VILA; i++) {
            for (j = 0; j < TAM_VILA; j++) 
            {
                int valorandom=rand()%2;
                if (valorandom==0 && mapa[0][i][j]=='g')
                    {
                        printf(GREEN "'" RESET " "/*,mapa[0][i][j]*/);
                    }
                    else if (valorandom==1 && mapa[0][i][j]=='g')
                    {
                        printf(GREEN "," RESET " "/*,mapa[0][i][j]*/);
                    }
                    else
                    {
                        printf("%c ",mapa[faseatual][i][j]);
                    }
                    
            }
            printf("\n");
        }
    }else if(faseatual == 1){
        for (i = 0; i < TAM_F1; i++) {
            for (j = 0; j < TAM_F1; j++) {
                printf("%c ", mapa[faseatual][i][j]);
            }
            printf("\n");
        }
    }else if(faseatual == 2){
        for (i = 0; i < TAM_F2; i++) {
            for (j = 0; j < TAM_F2; j++) {
                printf("%c ", mapa[faseatual][i][j]);
            }
            printf("\n");
        }
    }else{
        for (i = 0; i < TAM_F3; i++) {
            for (j = 0; j < TAM_F3; j++) {
                int valorandom=rand()%2;
                if (valorandom==0 && mapa[faseatual][i][j]=='L')
                    {
                        printf(RED "'" RESET " "/*,mapa[0][i][j]*/);
                    }
                    else if (valorandom==1 && mapa[faseatual][i][j]=='L')
                    {
                        printf(YELLOW "," RESET " "/*,mapa[0][i][j]*/);
                    }
                    else
                    {
                        printf("%c ",mapa[faseatual][i][j]);
                    }
            }
            printf("\n");
        }
    }    
}

void resetGeral()
{
    int l,p,k;
    morto=0;
    faseatual=0;
    reinicios=0;

    for (l = 0; l < 5; l++)
    {
        for  (p = 0; p < 40; p++)
        {
            for (k = 0; k < 40; k++)
            {
                mapa[l][p][k]=mapabackup[l][p][k];
            }   
        }
    }           
}

void atualizarMapaAtual()
{
    int tam;
    if (faseatual == 0) tam = TAM_VILA;
    else if (faseatual == 1) tam = TAM_F1;
    else if (faseatual == 2) tam = TAM_F2;
    else tam = TAM_F3;

    for (int i = 0; i < tam; i++) {
        for (int j = 0; j < tam; j++) {
            mapaAnterior[faseatual][i][j] = mapa[faseatual][i][j];
        }
    }
}

void desenharDiferencas()
{

int tam;
    if (faseatual == 0) tam = TAM_VILA;
    else if (faseatual == 1) tam = TAM_F1;
    else if (faseatual == 2) tam = TAM_F2;
    else tam = TAM_F3;

    for (int i = 0; i < tam; i++) {
        for (int j = 0; j < tam; j++) {
            if (mapa[faseatual][i][j] != mapaAnterior[faseatual][i][j]) {
                coordenadas(j, i);
                if (faseatual == 0 && mapa[0][i][j] == 'g') 
                {
                    int valorandom = rand() % 2;
                    if (valorandom == 0)
                    {
                        printf(GREEN "'" RESET " ");
                    }
                    else
                    {
                        printf(GREEN "," RESET " ");
                    }
                }
                else
                {
                    printf("%c ", mapa[faseatual][i][j]);
                }

                mapaAnterior[faseatual][i][j] = mapa[faseatual][i][j];
            }
        }
    }



}

void desenharEfeitos()
{


int tam;
    if (faseatual == 0) tam = TAM_VILA;
    else if (faseatual == 1) tam = TAM_F1;
    else if (faseatual == 2) tam = TAM_F2;
    else tam = TAM_F3;

    for (int i = 0; i < tam; i++) {
        for (int j = 0; j < tam; j++) {
            coordenadas(j, i);
            int valorandom = rand() % 16;
            
            if (valorandom == 0 && mapa[faseatual][i][j]=='g')
            {
                printf(GREEN "'" RESET " ");
            }
            else if (valorandom == 1 && mapa[faseatual][i][j]=='g')
            {
                printf(GREEN "," RESET " ");
            }
            
            valorandom = rand() % 2;
            if (valorandom==0 && mapa[faseatual][i][j]=='L')
            {
                printf(RED "'" RESET " "/*,mapa[0][i][j]*/);
            }
            else if (valorandom==1 && mapa[faseatual][i][j]=='L')
            {
                printf(YELLOW "," RESET " "/*,mapa[0][i][j]*/);
            }

            valorandom = rand() % 2;
            if (valorandom==0 && mapa[faseatual][i][j]=='1')
            {
                printf(YELLOW "▓" RESET " ");
            }
            else if(valorandom==1 && mapa[faseatual][i][j]=='1')
            {
                printf(YELLOW "▒" RESET " ");
            }



            valorandom = rand() % 2;
            if (valorandom==0 && mapa[faseatual][i][j]=='2')
            {
                printf(YELLOW "▒" RESET " ");
            }
            if (valorandom==1 && mapa[faseatual][i][j]=='2')
            {
                printf(YELLOW "░" RESET " ");
            }


            valorandom = rand() % 2;
            if (valorandom==0 && mapa[faseatual][i][j]=='3')
            {
                printf(YELLOW "░" RESET " ");
            }
            if (valorandom==1 && mapa[faseatual][i][j]=='3')
            {
                printf(YELLOW " " RESET " ");
                
            }

            
            mapaAnterior[faseatual][i][j] = mapa[faseatual][i][j];
        }
    }

}

void mudancaDeFases()
{
    system("cls");
    embaixoDoJogador = ' ';
    imprimirMapa();
    atualizarMapaAtual();
    
}

// =========== funcões relacionadas ao jogador ===========
void verificarMorto()
{
    if (reinicios >= 3) 
    {
        cursorRodape();
        printf("VOCÊ NaO MERECE ESTAR NO CASTELO, SEU ENERGÚMENO INÚTIL\n");
        morto=1;
    }
}

void resetarJogador() 
{
    mapa[faseatual][jogadorY][jogadorX] = embaixoDoJogador; // restaura o que estava ali
    jogadorX = posInicialX;
    jogadorY = posInicialY;
    embaixoDoJogador = ' '; // posicao inicial é chao
    mapa[faseatual][jogadorY][jogadorX] = '&';
}

void moverJogador(char tecla) 
{
    int novoX = jogadorX;
    int novoY = jogadorY;

    if (tecla == 'w') novoY--;
    else if (tecla == 's') novoY++;
    else if (tecla == 'a') novoX--;
    else if (tecla == 'd') novoX++;
    else
        return;

    // Verificacao de limites
    int tam;
    if (faseatual == 0) tam = TAM_VILA;
    else if (faseatual == 1) tam = TAM_F1;
    else if (faseatual == 2) tam = TAM_F2;
    else tam = TAM_F3;

    if (novoX < 0 || novoY < 0 || novoX >= tam || novoY >= tam)
        return;

    char destino = mapa[faseatual][novoY][novoX];

    if (destino == '*' || destino == 'D' || destino == 'P' || destino=='L') {
        return;
    }

    if (destino == '#' || destino == 'X' || destino == 'V') {
        cursorRodape();
        printf("Você morreu!\n");
        reinicios++;
        verificarMorto();
        system("pause");
        limparTexto();
        resetarJogador();
        return;
    }

    // mover o jogador
    mapa[faseatual][jogadorY][jogadorX] = embaixoDoJogador; // restaura o que estava antes
    embaixoDoJogador = destino; // salva o que está na nova posicao
    jogadorX = novoX;
    jogadorY = novoY;
    mapa[faseatual][jogadorY][jogadorX] = '&';
}

void PosInicialVariavel()
{
    int i, j;
    for (i = 0; i < 40; i++)
    {
        for (j = 0; j < 40; j++)
        {   
            if(mapa[faseatual][i][j] == '&')
            {
                posInicialX=j;
                posInicialY=i;
                jogadorY = i;
                jogadorX = j;
                break;
            }
        }
    }
}

void LimpaPersonagemDaFase() 
{
    int i, j;
    int tam;
    if (faseatual == 0) tam = TAM_VILA;
    else if (faseatual == 1) tam = TAM_F1;
    else if (faseatual == 2) tam = TAM_F2;
    else if (faseatual == 3) tam = TAM_F3;

    for (i = 0; i < tam; i++) 
    {
        for (j = 0; j < tam; j++) 
        {
            if (mapa[faseatual][i][j] == '&') 
            {
                mapa[faseatual][i][j] = ' ';
            }
        }
    }
}

void interagir()
{

    if (embaixoDoJogador == '@')
    {
        chaveColetada = 1;
        embaixoDoJogador = ' ';
        cursorRodape();
        printf("Você pegou a chave!\n");
        if (faseatual == 0)
        {
            for (i = 0; i < TAM_VILA; i++)
            {
                for (j = 0; j < TAM_VILA; j++)
                {
                    if (mapa[faseatual][i][j] == 'D')
                    {
                        mapa[faseatual][i][j] = '=';
                    }
                }
            }
        }
        else if (faseatual == 1)
        {
            for (i = 0; i < TAM_F1; i++)
            {
                for (j = 0; j < TAM_F1; j++)
                {
                    if (mapa[faseatual][i][j] == 'D')
                    {
                        mapa[faseatual][i][j] = '=';
                    }
                }
            }
        }
        else if (faseatual == 2)
        {
            for (i = 0; i < TAM_F2; i++)
            {
                for (j = 0; j < TAM_F2; j++)
                {
                    if (mapa[faseatual][i][j] == 'D')
                    {
                        mapa[faseatual][i][j] = '=';
                    }
                }
            }
        }
        else
        {
            for (i = 0; i < TAM_F3; i++)
            {
                for (j = 0; j < TAM_F3; j++)
                {
                    if (mapa[faseatual][i][j] == 'D')
                    {
                        mapa[faseatual][i][j] = '=';
                    }
                    mapa[faseatual][27][3] = ' ';
                    mapa[faseatual][26][3] = ' ';
                    mapa[faseatual][25][3] = ' ';
                }
            }
        }
        system("pause");
        limparTexto();
    }
    else if (embaixoDoJogador == '=' && chaveColetada)
    {
        cursorRodape();
        printf("Você abriu a porta!\n");
        LimpaPersonagemDaFase(faseatual);
        faseatual++;
        PosInicialVariavel();
        system("pause");
        limparTexto();
    }
    else if (embaixoDoJogador == 'O')
    {
        cursorRodape();
        printf("Você apertou o botao!\n");
        if (faseatual == 2)
        {
            mapa[2][14][14] = ' ';
            mapa[2][18][4] = '#';
            mapa[2][19][4] = '#';
        }
        else if (faseatual == 3)
        {
            mapa[3][34][36] = ' ';
            for (i = 8; i < 22; i++)
            {
                mapa[3][i][23] = '*';
            }
        }
        system("pause");
        limparTexto();
    }
    else if (embaixoDoJogador == '>')
    {
        for (i = 0; i < TAM_F3; i++)
        {
            for (j = 0; j < TAM_F3; j++)
            {
                if (mapa[faseatual][i][j] == '>' && !(i == jogadorY && j == jogadorX))
                {
                    mapa[faseatual][jogadorY][jogadorX] = '>';
                    jogadorX = j;
                    jogadorY = i;
                    mapa[faseatual][jogadorY][jogadorX] = '&';
                    return;
                }
            }
        }
    }
    else if(mapa[faseatual][jogadorY][jogadorX+1]=='P' || mapa[faseatual][jogadorY][jogadorX-1]=='P'||   
            mapa[faseatual][jogadorY+1][jogadorX]=='P'|| mapa[faseatual][jogadorY-1][jogadorX]=='P')
    {
        cursorRodape();
        for (i = 0; i < 300; i++)
        {
            Sleep(50);
            printf("%c",textoNpc[i]);
        }
        system("pause");
        limparTexto();
        
    }

}

//===============funcões dos monstros ====================
void moverMonstroAleatorio() 
{
    int x, y;
    int tam;
     if (faseatual==2)
    {
        tam=TAM_F2;
    }
    else if(faseatual == 3){
        tam = TAM_F3;
    }

    //======== contador de quantos monstros existem na fase =========
    int quantMonstro=0;
    for (x = 0; x < tam; x++)
    {
        for ( y = 0; y < tam; y++)
        {
            if (mapa[faseatual][y][x]=='X')
            {
                quantMonstro++;
            }
        }
    }
    
    int dirMonstro[quantMonstro];
    int posXmonstro[quantMonstro];
    int posYmonstro[quantMonstro];

    int contagem;
    //======= escolhe muma das 4 direcões pro monstro se movimentar ==========
    for (contagem = 0; contagem < quantMonstro; contagem++)
    {
        int dir = rand() % 4;
        dirMonstro[contagem]=dir;
    }
    
    contagem=0;

    //===== salva a posicao dos monstros, para quando for atualizar, apagar o X antigo do mapa==========
    for (x = 0; x < tam; x++)
    {
        for (y = 0; y < tam; y++)
        {
            if (mapa[faseatual][y][x] =='X')
            {
                posXmonstro[contagem]= x;
                posYmonstro[contagem]= y;
                contagem++;
            }
            
        }
        
    }
    


    //======== aqui de fato é o movimento, adiciona o valor de direcao, verifica a posicao antiga e apaga o que estava lá e desenha um X na posicao nova, além de verificar colisao com o jogador================================
    for (i =0;i<quantMonstro;i++)  
    {
        int x =posXmonstro[i];
        int y = posYmonstro[i];
        int novoX = x;
        int novoY = y;

        if (dirMonstro[i] == 0) novoY--;
        else if (dirMonstro[i] == 1) novoY++;
        else if (dirMonstro[i] == 2) novoX--;
        else if (dirMonstro[i] == 3) novoX++;

        if (mapa[faseatual][novoY][novoX] == ' ' || mapa[faseatual][novoY][novoX] == '&') 
        {                      
            if (mapa[faseatual][novoY][novoX] == '&') 
            {                          
                cursorRodape();                        
                printf("O monstro te pegou!\n");                        
                system("pause");
                reinicios++;                        
                verificarMorto();
                limparTexto();
                return;
            }
            mapa[faseatual][novoY][novoX] = 'X';
            mapa[faseatual][y][x] = ' ';
        }
    }

    /*========= código de movimentacao antiga, caso queriam rever!!!=================

        
    if (faseatual==2)
    {
        tam=TAM_F2;
    }
    else if(faseatual == 3)
    {
        tam = TAM_F3;
    }
    while(faseatual == 2 || faseatual == 3){
        for (y = 0; y < tam; y++) {
            for (x = 0; x < tam; x++) {
                if (mapa[faseatual][y][x] == 'X') {
                    int dir = rand() % 4;
                    int novoX = x;
                    int novoY = y;
                        
                    if (dir == 0) novoY--;
                    else if (dir == 1) novoY++;
                    else if (dir == 2) novoX--;
                    else if (dir == 3) novoX++;
                    
                    if (mapa[faseatual][novoY][novoX] == ' ' || mapa[faseatual][novoY][novoX] == '&') 
                    {
                        if (mapa[faseatual][novoY][novoX] == '&') 
                        {
                            cursorRodape();
                            printf("O monstro te pegou!\n");
                            reinicios++;
                            if (reinicios >= 3) 
                            {
                                cursorRodape();
                                printf("Reiniciou 3 vezes. Voltando ao menu.\n");
                                exit(0);
                            }
                            system("pause");
                            resetarJogador();
                        }
                        return;
                        mapa[faseatual][novoY][novoX] = 'X';
                        mapa[faseatual][y][x] = ' ';
                        return;
                    }
                            
                }
                        
            }
                    
        }
    }

    */
}

void moverMonstroInteligente() {
    int x, y;
    // Procura o monstro 'V' no mapa
    for (y = 0; y < TAM; y++) {
        for (x = 0; x < TAM; x++) {
            if (mapa[faseatual][y][x] == 'V') {
                // Calcula a diferenca de posicao entre monstro e jogador
                int deltaX = jogadorX - x;
                int deltaY = jogadorY - y;
                
                int novoX = x;
                int novoY = y;
                
                // Determina o movimento baseado na maior distância (Manhattan distance)
                if (abs(deltaX) > abs(deltaY)) {
                    // Move horizontalmente em direcao ao jogador
                    if (deltaX > 0) novoX++; // Jogador está à direita
                    else if (deltaX < 0) novoX--; // Jogador está à esquerda
                } else if (abs(deltaY) > 0) {
                    // Move verticalmente em direcao ao jogador
                    if (deltaY > 0) novoY++; // Jogador está abaixo
                    else if (deltaY < 0) novoY--; // Jogador está acima
                }
                
                // Verifica se a nova posicao é válida
                char destino = mapa[faseatual][novoY][novoX];
                
                // Pode se mover para espacos vazios ou onde está o jogador
                if (destino == ' ' || destino == '&') {
                    if (destino == '&') {
                        // Monstro pegou o jogador
                        cursorRodape();
                        printf("O monstro inteligente te pegou!\n");
                        system("pause");
                        reinicios++;
                        verificarMorto();
                        resetarJogador();
                        return;
                    }
                    // Move o monstro para a nova posicao
                    mapa[faseatual][novoY][novoX] = 'V';
                    mapa[faseatual][y][x] = ' ';
                    return;
                }
                // Se nao pode se mover na direcao preferida, tenta movimento alternativo
                else {
                    // Tenta movimento vertical se tentou horizontal primeiro
                    if (abs(deltaX) > abs(deltaY) && abs(deltaY) > 0) {
                        novoX = x; // Reset horizontal movement
                        if (deltaY > 0) novoY = y + 1;
                        else novoY = y - 1;
                        
                        destino =  mapa[faseatual][novoY][novoX];
                        if (destino == ' ' || destino == '&') {
                            if (destino == '&') {
                                cursorRodape();
                                printf("O monstro inteligente te pegou!\n");
                                system("pause");
                                reinicios++;
                                verificarMorto();
                                resetarJogador();
                                return;
                            }
                            mapa[faseatual][novoY][novoX] = 'V';
                            mapa[faseatual][y][x] = ' ';
                            return;
                        }
                    }
                    // Tenta movimento horizontal se tentou vertical primeiro
                    else if (abs(deltaY) >= abs(deltaX) && abs(deltaX) > 0) {
                        novoY = y; // Reset vertical movement
                        if (deltaX > 0) novoX = x + 1;
                        else novoX = x - 1;
                        
                        destino =  mapa[faseatual][novoY][novoX];
                        if (destino == ' ' || destino == '&') {
                            if (destino == '&') {
                                cursorRodape();
                                printf("O monstro inteligente te pegou!\n");
                                system("pause");
                                reinicios++;
                                verificarMorto();
                                resetarJogador();
                                return;
                            }
                            mapa[faseatual][novoY][novoX] = 'V';
                            mapa[faseatual][y][x] = ' ';
                            return;
                        }
                    }
                }
                return; // Sai após processar o primeiro (e único) monstro 'V'
            }
        }
    }
}

//==== funcões gerais do jogo e do terminal windows================
void RodarOJogo()
{
    desenharDiferencas();
    desenharEfeitos();

    //======= isso aqui faz com que o programa rode sem a necessidade de esperar uma tecla ser acionada, ou seja, em vez de ser turn-bases se torna RTS.
    if (_kbhit()) { //_kbhit e _getch reconhecem a tecla pressionada no teclado e puxa do caractere referente
        char tecla = _getch();
        if (tecla == 'i') {
            interagir();
        } else if(tecla =='m') {
            LimpaPersonagemDaFase(faseatual);
            faseatual++;
            PosInicialVariavel();
        }
        else{
            moverJogador(tecla);

        }
    }

    moverMonstroAleatorio();
    int valorRandom=rand()%4;
    if (valorRandom==0 || valorRandom==1 || valorRandom==2)
    {
        moverMonstroInteligente();
    }
    Sleep(200);
    
}

void animacaoMenu()
{           
    int tempo=0;
    int frames=0;
    int menu_contador=10;
    int i=0;
    int j=24; //<------JAMAIS MUDAR ESSA VARIAVEL PARA 25 OU MAIS//===== ela é sempre 1 menor que q quantidade de linhas da imagem usada;
 //animacao de iniciar o menu
    
    for(i=0;i<j;i++)
    {  
        system("cls");
        frames=j-1-i;
        for ( tempo = 0; tempo < 40000000; tempo++) //isso eh so pra nao printar instantaneamente....//// comentario do arthur: eu nao sabia usar a função Sleep e fiz isso aquikkkk
        {
            if (tempo==400000)
            {        
                for (menu_contador = frames; menu_contador<=j; menu_contador++)
                {                  
                    printf("%s",menuletra[menu_contador]);
                }
            }
        }
    }
}


void ajustarTamanhoConsole(int colunas, int linhas) 
{
    HANDLE hOut = GetStdHandle(STD_OUTPUT_HANDLE);

    // Define o tamanho do buffer
    COORD bufferSize;
    bufferSize.X = colunas;
    bufferSize.Y = linhas;
    SetConsoleScreenBufferSize(hOut, bufferSize);

    // Define o tamanho da janela
    SMALL_RECT windowSize;
    windowSize.Left = 0;
    windowSize.Top = 0;
    windowSize.Right = colunas - 1;
    windowSize.Bottom = linhas - 1;
    SetConsoleWindowInfo(hOut, TRUE, &windowSize);
}

void configurarLinguagem()
{
    setlocale(LC_ALL,"pt_BR.UTF-8");
    SetConsoleOutputCP(65001);
    SetConsoleCP(65001);
}

void configurarCores()
{
    //======== isso aqui faz com que o terminal windows aceite o código ANSI, que é do tipo utilizado no meu define ali em cima, ou seja, permita eu colorir os caracteres de uma forma mais simples. ========================================
    HANDLE hOut = GetStdHandle(STD_OUTPUT_HANDLE);
    DWORD dwMode = 0;
    GetConsoleMode(hOut, &dwMode);
    dwMode |= 0x0004; // ENABLE_VIRTUAL_TERMINAL_PROCESSING
    SetConsoleMode(hOut, dwMode);
}


// =============================== programa em sim aqui ====================================
// =============================== programa em sim aqui ====================================
// =============================== programa em sim aqui ====================================
// =============================== programa em sim aqui ====================================
// =============================== programa em sim aqui ====================================
// =============================== programa em sim aqui ====================================
// ======================AAAAAAAAA programa em sim aqui AAAAAAAAA===========================
// ========================AAAAAAA programa em sim aqui AAAAAAA=============================
// ==========================AAAAA programa em sim aqui AAAAA===============================
// ============================AAA programa em sim aqui AAA=================================
// ==============================A programa em sim aqui A===================================
// ================================= programa em sim  ======================================
// =================================== ograma em s  ========================================
// ===================================== grama em ==========================================
// ======================================= rama ============================================
// =========================================  ==============================================
// =========================================================================================

int main()
{
    srand(time(NULL));
    ajustarTamanhoConsole(150,50);
    configurarLinguagem();
    configurarCores();
    int linha,coluna;
    int menu=0;
    while (menu!=3) //jogo comeca aqui
    {   
        animacaoMenu();
        resetGeral();  
        
        printf("\nPara jogar digite 1\nPara ver os créditos digite 2");
        printf("\nPara sair do programa digite 3\nPara desenhar todos os mapas, digite 5\n");
        scanf("%d",&menu);

        if (menu==1)
        {
            system("cls");
            for (i = 0; i < 50; i++)
            {
                printf("%s",cutscene1[i]);
            }
            
            system ("pause");


            while(morto==0)
            {
                system("cls");
                imprimirMapa();
                atualizarMapaAtual();
                PosInicialVariavel();
                embaixoDoJogador = 'g';

                while (faseatual==0 && morto==0)
                {
                    RodarOJogo();
                }

                if (morto)break;
                mudancaDeFases();

                while (faseatual==1 && morto==0)
                {
                    RodarOJogo();
                }
                if (morto)break;
                mudancaDeFases();

                while (faseatual==2 && morto==0)
                {
                    RodarOJogo();
                }
                if (morto)break;
                system("cls");
                for (i = 0; i < 50; i++)
                {
                    printf("%s\n",cutscene2[i]);
                }
                cursorRodape(0,60);
                system("pause");
                mudancaDeFases();

                while (faseatual==3 && morto==0)
                {
                    RodarOJogo();
                }
                if (morto)break;
                system("cls");
                for (i = 0; i < 50; i++)
                {
                    printf("%s\n",cutsceneFinal[i]);
                }
                cursorRodape(0,51);
                system("pause");
                if (faseatual==4)
                {   
                    limparTexto();
                    cursorRodape();
                    printf("Você conquistou o castelo!!!\n");
                    system ("pause");
                    faseatual = 0;
                    jogadorX = 1;
                    jogadorY = 1;
                    posInicialX = 1;
                    posInicialY = 1;
                    chaveColetada = 0;
                    reinicios = 0;
                    menu = 0;                        
                    break;
                    system("pause");
                }
                

            }

        }
        if (menu==2)
        {
            printf("Créditos\nArthur Vicente Ono\nCaio Augusto Freitas Barbosa de Souza\nLuan Queiroz Fonseca de Menezes\n");
            system("pause");
            limparTexto();
        }
        
        if (menu==3)
        {
            printf("Até logo jogador!\n");
        }
        if (menu ==5)
        {
            
            
            for(linha=0;linha<10;linha++)
            {
                for(coluna=0;coluna<10;coluna++)
                {
                    int valorandom=rand()%2;
                    
                    if (valorandom==0 && mapa[0][linha][coluna]=='g')
                    {
                        printf(GREEN "'" RESET " "/*,mapa[0][linha][coluna]*/);
                    }
                    else if (valorandom==1 && mapa[0][linha][coluna]=='g')
                    {
                        printf(GREEN "," RESET " "/*,mapa[0][linha][coluna]*/);
                    }
                    else
                    {
                        printf("%c ",mapa[0][linha][coluna]);
                    }
                }
                printf("\n");
            }
            for(linha=0;linha<10;linha++)
            {
                for(coluna=0;coluna<10;coluna++)
                    {
                        printf("%c ",mapa[1][linha][coluna]);
                    }
                    printf("\n");
            }
            for(linha=0;linha<20;linha++)
            {
                for(coluna=0;coluna<20;coluna++)
                    {
                        printf("%c ",mapa[2][linha][coluna]);
                    }
                    printf("\n");
            }
            for(linha=0;linha<40;linha++)
            {
                for(coluna=0;coluna<40;coluna++)
                    {
                        printf("%c ",mapa[3][linha][coluna]);
                    }
                    printf("\n");
            }
        
        
            system("pause");


            
        }    
        
        
    }    


    return 0;
}
